{% extends "base.html" %}
{% load static %}
{% block title %}
  Blog
{% endblock %}
{% block content %}
  {% include "includes/toggle-theme.html" %}
  {% with request.resolver_match.view_name as view_name %}
    <div class="container">

      <div class="nav-scroller py-1 mb-3 border-bottom">
        <nav class="nav nav-underline justify-content-between">
          {% for category in page_obj.categories %}
            <a class="nav-item nav-link link-body-emphasis {% if category.slug in request.path %} active {% endif %}" href="{% url 'blog:category_posts' category.slug %}">{{ category.name }}</a>
          {% endfor %}
        </nav>
      </div>
    </div>
    
    <div class="container">
      <div class="p-4 p-md-5 mb-4 rounded text-body-emphasis bg-body-secondary">
        <div class="col-lg-6 px-0">
          {% with page_obj.posts|first as first_post %}
            {% if view_name == 'blog:category_posts' and page_obj.posts|length == 0 %}
              <h1 class="display-4 fst-italic">
                В данной категории пока нет статей
              </h1>
            {% else %}
              <h1 class="display-4 fst-italic">
                {{ first_post.name }}
              </h1>
              <p class="lead my-3">{{ first_post.text|truncatechars:100|safe }}</p>
              <p class="lead mb-0"><a href="{% url 'blog:post_detail' first_post.id %}" class="text-body-emphasis fw-bold">Continue reading...</a></p>
            {% endif %}
          {% endwith %}
        </div>
      </div>
      {% if page_obj.posts|length > 1 %}
        <div class="row mb-2">
          {% for post in page_obj.posts|slice:"0:5" %}
          <div class="col-md-6">
            <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
              <div class="col p-4 d-flex flex-column position-static">
                <strong class="d-inline-block mb-2 text-primary-emphasis">{{ post.category }}</strong>
                <h3 class="mb-0">{{ post.name }}</h3>
                <div class="mb-1 text-body-secondary">{{ post.pub_date }}</div>
                <a href="{% url 'blog:post_detail' post.id %}" class="icon-link gap-1 icon-link-hover stretched-link">
                  Continue reading
                  <svg class="bi"><use xlink:href="#chevron-right"/></svg>
                </a>
              </div>
              <div class="col-auto d-none d-lg-block">
                <img class="bd-placeholder-img" src="{{ post.main_foto.url }}" alt="" style="object-fit: cover;" height="200" width="200">
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <div class="row g-5">
        <div class="col-md-8">
          {% if page_obj.posts|length > 0 %}
            <h3 class="pb-4 mb-4 fst-italic border-bottom">
              Fresh
            </h3>
            {% for post in page_obj.posts|slice:"0:5" %}
              <article class="blog-post">
                <h2 class="display-5 link-body-emphasis mb-1">{{ post.name }}</h2>
                <p class="blog-post-meta">{{post.pub_date}} by <a href="#">Aleksandr Buchelnikov</a></p>
                <p>{{ post.text|safe }}</p>
              </article>
            {% endfor %}
            <!-- <nav class="blog-pagination" aria-label="Pagination">
              <a class="btn btn-outline-primary rounded-pill" href="#">Older</a>
              <a class="btn btn-outline-secondary rounded-pill disabled" aria-disabled="true">Newer</a>
            </nav> -->
          {% endif %}
        </div>
        
        <div class="col-md-4">
          <div class="position-sticky" style="top: 2rem;">
            {% include "includes/blog_sidebar.html" %}
          </div>
        </div>
      </div>
    </div>
  {% endwith %}
{% endblock %}